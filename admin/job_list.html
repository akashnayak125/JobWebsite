<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job List - Admin Panel</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.bootstrap5.min.css">
    <style>
        :root {
            --sidebar-width: 250px;
            --topbar-height: 60px;
            --primary-color: #2d3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
        }

        body {
            min-height: 100vh;
            background-color: #f5f6fa;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--primary-color);
            padding-top: var(--topbar-height);
            color: white;
            z-index: 1000;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 15px 25px;
            font-size: 1.1em;
            border-left: 3px solid transparent;
            transition: all 0.3s;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background: var(--secondary-color);
            border-left-color: var(--accent-color);
        }

        .sidebar .nav-link i {
            width: 25px;
            margin-right: 10px;
        }

        /* Topbar Styles */
        .topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--topbar-height);
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 900;
            display: flex;
            align-items: center;
            padding: 0 30px;
        }

        .brand {
            color: var(--primary-color);
            font-size: 1.5em;
            font-weight: bold;
            margin-left: var(--sidebar-width);
        }

        /* Main Content Area */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: calc(var(--topbar-height) + 30px) 30px 30px;
        }

        /* Table Styling */
        .table-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .action-buttons .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.875rem;
        }

        .status-active {
            background-color: #d4edda;
            color: #155724;
        }

        .status-expired {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-draft {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Custom DataTables styling */
        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid #dce7f1;
            border-radius: 4px;
            padding: 5px 10px;
        }

        .dataTables_wrapper .dataTables_length select {
            border: 1px solid #dce7f1;
            border-radius: 4px;
            padding: 5px 10px;
        }

        .dt-buttons .btn {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <nav class="nav flex-column">
            <a class="nav-link" href="dashboard.html">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link" href="add_job.html">
                <i class="fas fa-plus-circle"></i> Add Job
            </a>
            <a class="nav-link active" href="job_list.html">
                <i class="fas fa-list"></i> Job List
            </a>
            <a class="nav-link" href="add_company.html">
                <i class="fas fa-building"></i> Add Company
            </a>
            <a class="nav-link" href="company_list.html">
                <i class="fas fa-th-list"></i> Company List
            </a>
            <a class="nav-link" href="applications.html">
                <i class="fas fa-users"></i> Applications
            </a>
            <a class="nav-link" href="settings.html">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>
    </div>

    <!-- Topbar -->
    <div class="topbar">
        <div class="brand">Job Portal Admin</div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Job Listings</h2>
            <a href="add_job.html" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add New Job
            </a>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="row">
                <div class="col-md-3">
                    <label for="dateFilter" class="form-label">Posted Date</label>
                    <select class="form-select" id="dateFilter">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="statusFilter" class="form-label">Status</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="expired">Expired</option>
                        <option value="draft">Draft</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="companyFilter" class="form-label">Company</label>
                    <select class="form-select" id="companyFilter">
                        <option value="">All Companies</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="jobTypeFilter" class="form-label">Job Type</label>
                    <select class="form-select" id="jobTypeFilter">
                        <option value="">All Types</option>
                        <option value="Full Time">Full Time</option>
                        <option value="Part Time">Part Time</option>
                        <option value="Contract">Contract</option>
                        <option value="Freelance">Freelance</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Job List Table -->
        <div class="table-card">
            <table id="jobTable" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Job Title</th>
                        <th>Company</th>
                        <th>Location</th>
                        <th>Posted Date</th>
                        <th>Deadline</th>
                        <th>Status</th>
                        <th>Applications</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be loaded dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../assets/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize DataTable
            var table = $('#jobTable').DataTable({
                ajax: {
                    url: 'get_jobs.php',
                    dataSrc: ''
                },
                columns: [
                    { 
                        data: 'job_title',
                        render: function(data, type, row) {
                            return '<a href="job_details.html?id=' + row.id + '" class="fw-bold">' + data + '</a>';
                        }
                    },
                    { 
                        data: 'company_name',
                        render: function(data, type, row) {
                            return '<div class="d-flex align-items-center">' +
                                   '<img src="../' + row.company_logo + '" alt="' + data + '" style="width: 30px; height: 30px; margin-right: 10px;">' +
                                   data +
                                   '</div>';
                        }
                    },
                    { data: 'location' },
                    { 
                        data: 'posting_date',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'application_deadline',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    { 
                        data: 'status',
                        render: function(data) {
                            let className = 'status-' + data.toLowerCase();
                            return '<span class="status-badge ' + className + '">' + data + '</span>';
                        }
                    },
                    { 
                        data: 'applications_count',
                        render: function(data) {
                            return '<span class="badge bg-info">' + data + '</span>';
                        }
                    },
                    {
                        data: null,
                        render: function(data, type, row) {
                            return '<div class="action-buttons">' +
                                   '<button class="btn btn-sm btn-primary me-1" onclick="editJob(' + row.id + ')"><i class="fas fa-edit"></i></button>' +
                                   '<button class="btn btn-sm btn-danger" onclick="deleteJob(' + row.id + ')"><i class="fas fa-trash"></i></button>' +
                                   '</div>';
                        }
                    }
                ],
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'btn btn-success'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'btn btn-danger'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Print',
                        className: 'btn btn-info'
                    }
                ],
                order: [[3, 'desc']], // Sort by posted date by default
                pageLength: 10,
                responsive: true
            });

            // Apply filters
            $('#dateFilter, #statusFilter, #companyFilter, #jobTypeFilter').on('change', function() {
                table.draw();
            });

            // Custom filtering function
            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                let dateFilter = $('#dateFilter').val();
                let statusFilter = $('#statusFilter').val();
                let companyFilter = $('#companyFilter').val();
                let jobTypeFilter = $('#jobTypeFilter').val();
                
                let row = table.row(dataIndex).data();
                let pass = true;

                // Date filtering
                if (dateFilter) {
                    let postedDate = new Date(row.posting_date);
                    let today = new Date();
                    
                    switch(dateFilter) {
                        case 'today':
                            pass = pass && postedDate.toDateString() === today.toDateString();
                            break;
                        case 'week':
                            let weekAgo = new Date();
                            weekAgo.setDate(weekAgo.getDate() - 7);
                            pass = pass && postedDate >= weekAgo;
                            break;
                        case 'month':
                            let monthAgo = new Date();
                            monthAgo.setMonth(monthAgo.getMonth() - 1);
                            pass = pass && postedDate >= monthAgo;
                            break;
                    }
                }

                // Status filtering
                if (statusFilter) {
                    pass = pass && row.status.toLowerCase() === statusFilter.toLowerCase();
                }

                // Company filtering
                if (companyFilter) {
                    pass = pass && row.company_name === companyFilter;
                }

                // Job Type filtering
                if (jobTypeFilter) {
                    pass = pass && row.job_nature === jobTypeFilter;
                }

                return pass;
            });
        });

        // Edit job function
        function editJob(id) {
            window.location.href = 'edit_job.html?id=' + id;
        }

        // Delete job function
        function deleteJob(id) {
            if (confirm('Are you sure you want to delete this job?')) {
                fetch('delete_job.php?id=' + id, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        $('#jobTable').DataTable().ajax.reload();
                    } else {
                        alert('Error deleting job: ' + data.message);
                    }
                });
            }
        }
    </script>
</body>
</html>
